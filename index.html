<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Coffe Bell ERP</title>

    <!-- Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Inter:wght@400;500;600&display=swap"
        rel="stylesheet">
    <!-- Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- CSS -->
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <!-- Setup Screen -->
    <div id="setup-screen" class="auth-wrapper" style="display:none; z-index:9999; background:#fff;">
        <div class="login-card">
            <h2>Configuraci贸n Inicial</h2>
            <p>Ingresa la URL del Script de Google</p>
            <input type="text" id="api-url-input" class="form-control"
                placeholder="https://script.google.com/macros/s/...">
            <br><br>
            <button class="btn btn-primary" onclick="saveApiUrl()">Guardar y Continuar</button>
        </div>
    </div>

    <!-- Login Screen -->
    <div id="login-screen" class="auth-wrapper" style="display:none;">
        <div class="login-card">
            <h2>Coffe Bell</h2>
            <div class="form-group">
                <input type="text" id="username" class="form-control" placeholder="Usuario">
            </div>
            <div class="form-group">
                <input type="password" id="password" class="form-control" placeholder="Contrase帽a">
            </div>
            <div id="login-error" style="color: red; margin-bottom: 15px;"></div>
            <button class="btn btn-primary" onclick="attemptLogin()">Ingresar</button>
        </div>
    </div>

    <!-- App Content -->
    <div id="app-content" class="app-container" style="display:none;">

        <!-- Sidebar (Desktop) -->
        <div class="sidebar">
            <div class="brand">
                <span class="material-icons">coffee</span> Coffe Bell
            </div>

            <!-- Admin Nav -->
            <div id="nav-admin" class="nav-group" style="display:none;">
                <div class="nav-item active" onclick="showView('dashboard')">
                    <span class="material-icons">dashboard</span> General
                </div>
                <!-- Tables View link for admin too -->
                <div class="nav-item" onclick="showView('tables')">
                    <span class="material-icons">table_restaurant</span> Mesas
                </div>
                <div class="nav-item" onclick="showView('inventory')">
                    <span class="material-icons">inventory_2</span> Stock
                </div>
                <div class="nav-item" onclick="showView('finance')">
                    <span class="material-icons">attach_money</span> Finanzas
                </div>
                <div class="nav-item" onclick="showView('reports')">
                    <span class="material-icons">bar_chart</span> Reportes
                </div>
                <div class="nav-item" onclick="showView('products')">
                    <span class="material-icons">restaurant_menu</span> Carta / Recetas
                </div>

                <div class="nav-item" onclick="showView('kitchen')">
                    <span class="material-icons">soup_kitchen</span> Cocina
                </div>
                <div class="nav-item" onclick="showView('cashier')">
                    <span class="material-icons">point_of_sale</span> Caja
                </div>
            </div>

            <!-- Mozo Nav -->
            <div id="nav-mozo" class="nav-group" style="display:none;">
                <div class="nav-item active" onclick="showView('tables')">
                    <span class="material-icons">table_restaurant</span> Mis Mesas
                </div>
                <div class="nav-item" onclick="showView('waiter')">
                    <span class="material-icons">restaurant</span> Tomar Orden
                </div>
            </div>

            <!-- Cocina Nav -->
            <div id="nav-cocina" class="nav-group" style="display:none;">
                <div class="nav-item active" onclick="showView('kitchen')">
                    <span class="material-icons">soup_kitchen</span> Pedidos
                </div>
            </div>

            <!-- Caja Nav -->
            <div id="nav-caja" class="nav-group" style="display:none;">
                <div class="nav-item active" onclick="showView('cashier')">
                    <span class="material-icons">point_of_sale</span> Caja
                </div>
            </div>

            <div style="margin-top: auto;">
                <div class="nav-item" onclick="logout()">
                    <span class="material-icons">logout</span> Logout
                </div>
            </div>
        </div>

        <!-- Main View Area -->
        <div class="main-content">

            <!-- Dashboard View -->
            <div id="view-dashboard" class="view-section">
                <h1>Panel General</h1>
                <div class="stats-grid">
                    <div class="card stat-card" style="background: linear-gradient(45deg, #6F4E37, #8D6E63);">
                        <h3>Ventas Hoy</h3>
                        <div style="font-size: 32px; font-weight: bold;" id="dash-sales">S/ 0.00</div>
                    </div>
                    <div class="card stat-card" style="background: linear-gradient(45deg, #BE9063, #D4A574);">
                        <h3>Pedidos</h3>
                        <div style="font-size: 32px; font-weight: bold;" id="dash-orders">0</div>
                    </div>
                    <div class="card stat-card" style="background: linear-gradient(45deg, #5D4037, #795548);">
                        <h3>Mesas Ocupadas</h3>
                        <div style="font-size: 32px; font-weight: bold;" id="dash-tables">0</div>
                    </div>
                </div>
            </div>

            <!-- Tables View -->
            <div id="view-tables" class="view-section">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                    <h1>Gesti贸n de Mesas</h1>
                    <button class="btn btn-sm btn-secondary" onclick="renderTablesFromState()"> Refrescar</button>
                </div>
                <div class="tables-grid" id="tables-grid">
                    <!-- Tables rendered here -->
                </div>
            </div>

            <!-- Waiter View (Order Taking) -->
            <div id="view-waiter" class="view-section">
                <h1>Nueva Comanda</h1>
                <div style="margin-bottom: 20px;">
                    <select id="table-select" class="form-control">
                        <!-- Options -->
                    </select>
                </div>

                <div style="display:flex; gap:20px; height: calc(100vh - 200px);">
                    <!-- Left: Product List -->
                    <div style="flex:2; overflow-y:auto; padding-right:10px;">
                        <div class="products-grid" id="product-list">
                            <!-- Products -->
                        </div>
                    </div>

                    <!-- Right: Cart Summary (Desktop) -->
                    <div class="card"
                        style="flex:1; display:flex; flex-direction:column; height:fit-content; border: 1px solid #ddd;">
                        <h3>Pedido Actual</h3>
                        <div id="current-order-items">
                            <div class="empty-cart">Vacio</div>
                        </div>
                        <div class="order-total"
                            style="margin-top: 15px; padding-top:10px; border-top:1px solid #eee; display:flex; justify-content:space-between;">
                            <span>Total:</span>
                            <span id="order-total" style="font-size: 20px; color: var(--primary); font-weight:bold">S/
                                0.00</span>
                        </div>
                        <button class="btn btn-success btn-submit-order" style="width:100%; margin-top:15px;"
                            onclick="submitOrder()">Enviar a Cocina</button>
                        <button class="btn btn-white" style="width:100%; margin-top:10px; border:1px solid #ddd;"
                            onclick="showView('tables')">Cancelar / Volver</button>
                    </div>
                </div>

                <!-- Sticky Cart for Mobile -->
                <div id="cart-sticky-bar" class="cart-sticky-bar">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;">
                        <span style="font-weight:bold; color:var(--primary)">Tu Pedido:</span>
                        <span id="sticky-cart-total" style="font-weight:bold; font-size:16px">Total: S/ 0.00</span>
                    </div>
                    <div id="sticky-cart-items" class="cart-items-preview"></div>
                    <button class="btn btn-success btn-submit-order" style="width:100%" onclick="submitOrder()">Enviar a
                        Cocina</button>
                </div>
            </div>

            <!-- Kitchen View -->
            <div id="view-kitchen" class="view-section">
                <h1>Cocina - Pedidos Pendientes</h1>
                <div class="kitchen-board" id="kitchen-board">
                    <!-- Tickets -->
                </div>
            </div>

            <!-- Cashier View -->
            <div id="view-cashier" class="view-section">
                <h1>Caja - Pagos Pendientes</h1>
                <div class="card">
                    <table style="width:100%; border-collapse: collapse;">
                        <thead>
                            <tr style="text-align:left; border-bottom:2px solid #eee;">
                                <th style="padding:10px;">Orden</th>
                                <th>Mesa</th>
                                <th>Mozo</th>
                                <th>Total</th>
                                <th>Estado</th>
                                <th>Acci贸n</th>
                            </tr>
                        </thead>
                        <tbody id="cashier-list"></tbody>
                    </table>
                </div>
            </div>

            <!-- Inventory View -->
            <div id="view-inventory" class="view-section">
                <h1>Control de Insumos</h1>
                <div class="card">
                    <button class="btn btn-primary" style="margin-bottom:15px;" onclick="registerEntry()">+ Registrar
                        Ingreso</button>
                    <table style="width:100%; border-collapse:collapse;">
                        <thead>
                            <tr
                                style="text-align:left; border-bottom:1px solid #eee; color:#888; font-size:12px; text-transform:uppercase;">
                                <th style="padding:10px;">Insumo</th>
                                <th>Stock Actual</th>
                                <th>Unidad</th>
                                <th>Estado</th>
                            </tr>
                        </thead>
                        <tbody id="inventory-list">
                            <!-- JS Populated -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Finance View -->
            <div id="view-finance" class="view-section">
                <h1>Finanzas & Reportes</h1>

                <div class="stats-grid">
                    <div class="card stat-card" style="background-color:#43a047">
                        <h3>Ingresos Totales</h3>
                        <div style="font-size: 32px; font-weight: bold;" id="fin-sales">S/ 0.00</div>
                    </div>
                    <div class="card stat-card" style="background-color:#d32f2f">
                        <h3>Gastos Operativos</h3>
                        <div style="font-size: 32px; font-weight: bold;" id="fin-expenses">S/ 0.00</div>
                    </div>
                    <div class="card stat-card" style="background-color:#1976d2">
                        <h3>Utilidad Neta</h3>
                        <div style="font-size: 32px; font-weight: bold;" id="fin-profit">S/ 0.00</div>
                    </div>
                </div>

                <div class="card">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <h3>Registro de Gastos</h3>
                        <button class="btn btn-sm btn-secondary" onclick="registerExpense()">+ Nuevo Gasto</button>
                    </div>
                    <table style="width:100%; margin-top:15px; border-collapse:collapse;">
                        <thead>
                            <tr style="text-align:left; color:#888; font-size:12px; border-bottom:1px solid #eee;">
                                <th style="padding:10px;">Fecha</th>
                                <th>Descripci贸n</th>
                                <th>Categor铆a</th>
                                <th>Monto</th>
                            </tr>
                        </thead>
                        <tbody id="expense-list"></tbody>
                    </table>
                </div>
            </div>

            <!-- Products View -->
            <div id="view-products" class="view-section">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                    <h1>Gesti贸n de Carta y Recetas</h1>
                    <button class="btn btn-primary" onclick="addNewProductUi()">+ Nuevo Producto</button>
                </div>
                <div class="card">
                    <table style="width:100%; border-collapse:collapse;">
                        <thead>
                            <tr style="text-align:left; border-bottom:1px solid #eee;">
                                <th style="padding:10px;">Producto</th>
                                <th>Precio (S/)</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="admin-products-list"></tbody>
                    </table>
                </div>
            </div>

            <!-- Reports View -->
            <div id="view-reports" class="view-section">
                <h1>Inteligencia de Negocio</h1>

                <div class="card">
                    <h3>Top 5 Productos M谩s Vendidos</h3>
                    <table style="width:100%; border-collapse:collapse; margin-top:10px;">
                        <thead>
                            <tr style="text-align:left; border-bottom:1px solid #eee; font-size:12px; color:#888;">
                                <th style="padding:5px;">Producto</th>
                                <th>Cantidad Vendida</th>
                            </tr>
                        </thead>
                        <tbody id="report-top-products"></tbody>
                    </table>
                </div>

                <div class="card">
                    <h3>Rendimiento del Personal (Ventas por Mozo)</h3>
                    <table style="width:100%; border-collapse:collapse; margin-top:10px;">
                        <thead>
                            <tr style="text-align:left; border-bottom:1px solid #eee; font-size:12px; color:#888;">
                                <th style="padding:5px;">Mozo</th>
                                <th>Total Vendido</th>
                            </tr>
                        </thead>
                        <tbody id="report-waiter-perf"></tbody>
                    </table>
                </div>
            </div>

        </div> <!-- End Main Content -->

        <!-- Mobile Nav -->
        <div class="mobile-nav" id="mobile-nav">
            <div class="mobile-nav-item active" onclick="showView('tables')">
                <span class="material-icons">table_restaurant</span>
                Mesas
            </div>
            <div class="mobile-nav-item" onclick="showView('kitchen')">
                <span class="material-icons">soup_kitchen</span>
                Cocina
            </div>
            <div class="mobile-nav-item" onclick="showView('cashier')">
                <span class="material-icons">point_of_sale</span>
                Caja
            </div>
            <div class="mobile-nav-item" onclick="logout()">
                <span class="material-icons">logout</span>
                Salir
            </div>
        </div>

    </div>

    <!-- Generic Modal -->
    <div id="generic-modal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h3 id="modal-title">T铆tulo</h3>
                <span class="modal-close" onclick="closeModal()">&times;</span>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- Dynamic Content -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-white" style="border:1px solid #ddd" onclick="closeModal()">Cancelar</button>
                <button id="modal-save-btn" class="btn btn-primary">Guardar</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="app.js"></script>
</body>

</html>
